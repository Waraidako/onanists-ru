#### Способы тактирования МК

**Внутренний генератор**:

* Как правило на базу внутренней RC цепи
* Не требует внешних подключений
* Ограничен выбор частот

**Внутренний генератор с внешней RC цепью**:

* Частота определяется номиналами R & C
* Широкий выбор частот
* Требует внешних подключений

![Pasted image 20250312103427.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312103427.png)

**Внутренний генератор с внешним кварцевым резонатором**:

* Частота по сравнению с RC цепью меньше зависит от температуры
* Нужна внешняя схема

![Pasted image 20250312103645.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312103645.png)

**Внешний генератор**:
Хорош для синхронной работы нескольких устройств
![Pasted image 20250312103704.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312103704.png)

#### Схема тактирования ATmega8515

Источник тактового сигнала выбирается FUSE битами:
Прикол разделения тактрования - по одному отрубать модули коль надо

|Device clocking option|CKSEL3.0|
|----------------------|--------|
|External Crystal/Ceramic Resonator|1111-1010|
|External Low-Frequency Crystal|1001|
|Externa RC Oscillator|1000-0101|
|Calibrated Internal RC Oscillator|0100-0001|
|External Clock|0000|

![Pasted image 20250312104207.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312104207.png)

#### Кварцевые резонаторы и генераторы

**Резонатор** - пассивный девайс, ему нужны внешние генератор сигнала и ограничители нагрузки
![Pasted image 20250312104745.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312104745.png)
![Pasted image 20250312104837.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312104837.png)
Частный случай - 32768 Гц (~32 кГц) - часовые кварцевые резонаторы
**Генератор (осциллятор)** - активный девайс, резонатор + осциллятор в одном
![Pasted image 20250312105159.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312105159.png)
![Pasted image 20250312105214.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312105214.png)
^ милашка :3

#### Обощённая схема таймера/счётчика

![Pasted image 20250312105730.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312105730.png)
// Pretty straightforward if you ask me lol

#### Применение таймеров/счётчиков

|Компонент|Применение|
|---------|----------|
|Счётчик, на вход которого подан тактовый сигнал МК|Отсчёт заданного интервала времени ака **таймер**|
|Счётчик, на вход которого подан внешний сигнал|Подсчёт внешних событий ака **счётчик**|
|Счётчик + схема захвата|Измерение интервала времени ака **секундомер**. В частности для определения внешних сигналов|
|Счётчик + порт в/в|Формирование одиночных импульсов с заданными длительностью и задержкой|
|Счётчик + схема сравнения + порт в/в|Формирование периодических сигналов с заданными параметрами (частота, скважность, сдвиг фаз). В частности:<br>- Деление частоты<br>- ШИМ-сигнал|

#### Таймер - отсчёт времени и событий

Отсчёт - переполнен счётчик -> прошло время, паникуй, кидай прерывание, fuck midgets, hail Satan
**Частота счёта** - $F_{cnt}=\dfrac{1}{T_{cnt}}=\dfrac{F_{ck}}{K}$
$F_{CK}$ - тактовая частота МК
$K$ - предделитель (см. схему выше)
**Интервал времени** - $t=(N_{max}-N_0)T_{cnt}=(2^n-N_0)\dfrac{K}{F_{ck}}$
**Начальное значение** - $N_0=2^n-\dfrac{tF_{ck}}{K}$

![Pasted image 20250312110753.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312110753.png)

#### Таймер - функция захвата

Захват - значения из счётчика. Есть сигнал на захват - хватай уёбка сажай в регистр флагов
$F_{cnt}=\dfrac{F_{ck}}{K}=\dfrac{1}{T_{cnt}}$
**Измеряемый интервал времени** - $\Delta t=t_2-t_1=(N_2-N_1)T_{cnt}=(N_2-N_1)\dfrac{K}{F_{ck}}$
![Pasted image 20250312111056.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312111056.png)

#### Таймер - функция сравнения

Формирует на выходе МК сигналы с заданными параметрами (частота, скважность (хуй бумажность хыхыхыхы смишно), сдвиг фаз)
Всё в целом тоже просто - каждый такт чекаем дошли до нужного значения или нет, если дошли - кидаем флаги и прерывание
![Pasted image 20250312112012.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312112012.png)
![Pasted image 20250312112022.png](%D0%9F%D0%B8%D0%BA%D1%87%D0%B8/%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8/Pasted%20image%2020250312112022.png)
